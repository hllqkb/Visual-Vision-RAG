# Visual-Vision-RAG

视频内容理解与RAG查询系统，基于大模型技术，实现对视频内容的智能分析与检索。

## 项目介绍

Visual-Vision-RAG 是一个基于大模型技术的视频内容理解与检索系统，它能够：

- 自动提取视频关键帧
- 智能分析画面内容
- 生成视频内容时间线
- 支持基于RAG的视频内容查询
- 生成视频事件总结

本系统采用"离散采样 + RAG"的方法让大模型理解视频内容：

1. **离散采样**：将视频拆分为关键帧序列
2. **时序保留**：为每帧保存时间信息
3. **单帧分析**：分析每帧画面内容
4. **向量化存储**：将分析结果存入向量数据库
5. **RAG查询**：基于用户问题检索相关视频内容
6. **内容总结**：生成视频事件和内容概述

## 安装与运行

### 环境要求

- Python 3.8+
- PaddlePaddle 2.0+
- PyTorch 1.8+
- Transformers 4.20.0-4.x (兼容版本)
- OpenCV
- Streamlit

### 依赖安装

```bash
pip install -r requirements.txt
```

### 运行方式

```bash
python main.py
```

或直接运行Streamlit应用：

```bash
streamlit run app.py
```

## 使用指南

1. 在侧边栏调整分析参数（或使用默认值）
2. 上传视频文件（支持MP4, AVI, MOV, MKV, WMV格式）
3. 点击"开始分析视频"按钮
4. 等待系统提取关键帧并进行分析
5. 查看分析结果和总结
6. 使用RAG功能查询视频内容

## 系统架构

系统由以下几个主要组件构成：

- **视频处理模块**：负责视频关键帧提取
- **图像分析模块**：使用大模型或自定义工具分析图像内容
- **向量存储模块**：将分析结果向量化存储
- **RAG查询模块**：基于用户问题检索相关视频内容
- **内容总结模块**：生成视频事件总结

## 最近更新

### v1.1 (最新修复)
- **修复了查询按钮点击后内容消失的问题**
  - 修复了Streamlit会话状态管理
  - 添加了容器隔离，防止查询结果影响其他内容显示
  - 增强了错误处理和日志记录
- **改进了嵌入模型稳定性**
  - 修复了PaddlePaddle静态图模式问题
  - 使用tools.py中的FixedDimensionImageEmbeddings替代简单哈希
  - 添加了降级方案，确保系统稳定性
- **修复了LangChain兼容性问题**
  - 更新了FAISS导入路径
  - 修复了向量数据库相关警告
- **优化了查询结果显示**
  - 支持多种返回格式
  - 添加了成功提示和错误处理
  - 改进了结果展示布局
- **完善了文档和测试**
  - 创建了详细的使用指南(USAGE.md)
  - 添加了测试脚本(test_query.py)
  - 更新了requirements.txt

## 常见问题

### 查询没有返回结果

可能的原因：
- 向量存储未正确初始化
- 查询与视频内容相关度低
- 嵌入模型出现问题

解决方法：
- 检查控制台日志，查看详细错误信息
- 尝试使用与视频内容更相关的查询
- 重新分析视频，确保关键帧提取和分析正确

### 其他问题

如遇到其他问题，请查看控制台日志或提交issue。

## 许可证

本项目采用 MIT 许可证
